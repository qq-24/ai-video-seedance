# 本地化改造剩余修复 - 实施计划

## 当前状态

**已完成**:
- Prisma + SQLite 数据库
- 认证模块（Iron Session + 密码保护）
- 本地文件存储模块
- 数据库操作层（projects, scenes, media, materials, video-chains）
- 中间件
- 核心 API（登录/登出、项目、场景、图片/视频生成）
- 部分前端组件

**待修复**:
- 约 60+ 个类型错误
- 字段名统一从 snake_case 改为 camelCase
- 剩余前端组件更新
- 剩余 API 路由更新

---

## [ ] 任务 1: 批量修复字段名问题
- **Priority**: P0
- **Depends On**: None
- **Description**: 
  - 创建通用的类型转换工具
  - 批量搜索并替换剩余组件中的字段名
  - 主要替换：
    - `order_index` → `orderIndex`
    - `image_status` → `imageStatus`
    - `video_status` → `videoStatus`
    - `storage_path` → `storagePath`
    - `image_confirmed` → `imageConfirmed`
    - `video_confirmed` → `videoConfirmed`
    - `description_confirmed` → `descriptionConfirmed`
    - `task_id` → `taskId`
    - `created_at` → `createdAt`
    - `updated_at` → `updatedAt`
    - `user_id` → `userId`（已删除，但要检查引用）
    - `project_id` → `projectId`
    - `scene_id` → `sceneId`
- **Success Criteria**:
  - 类型错误减少 50%+
- **Test Requirements**:
  - `programmatic` TR-1.1: 运行 `npx tsc --noEmit` 错误数 < 30
  - `human-judgement` TR-1.2: 检查核心组件是否能正常导入和使用

---

## [ ] 任务 2: 修复剩余前端组件（SceneVideoList）
- **Priority**: P0
- **Depends On**: Task 1
- **Description**: 
  - 更新 SceneVideoList.tsx 字段名
  - 更新 SceneVideoCard.tsx 已完成
- **Success Criteria**:
  - SceneVideoList.tsx 无类型错误
- **Test Requirements**:
  - `programmatic` TR-2.1: SceneVideoList.tsx 通过 TypeScript 检查

---

## [ ] 任务 3: 修复剩余前端组件（项目列表）
- **Priority**: P0
- **Depends On**: Task 1
- **Description**: 
  - 更新 projects/page.tsx 字段名
  - 更新 ProjectCard.tsx 字段名
- **Success Criteria**:
  - 项目列表页面组件无类型错误
- **Test Requirements**:
  - `programmatic` TR-3.1: projects/page.tsx 通过 TypeScript 检查

---

## [ ] 任务 4: 修复剩余前端组件（创建项目表单）
- **Priority**: P0
- **Depends On**: Task 1
- **Description**: 
  - 更新 CreateProjectForm.tsx 字段名
- **Success Criteria**:
  - 创建项目表单无类型错误
- **Test Requirements**:
  - `programmatic` TR-4.1: CreateProjectForm.tsx 通过 TypeScript 检查

---

## [ ] 任务 5: 修复剩余前端组件（登录/注册）
- **Priority**: P0
- **Depends On**: Task 1
- **Description**: 
  - 更新 LoginForm.tsx（已简化）
  - 移除 RegisterForm.tsx（不再需要）
  - 更新 login/page.tsx
- **Success Criteria**:
  - 登录页面无类型错误
- **Test Requirements**:
  - `programmatic` TR-5.1: login/page.tsx 通过 TypeScript 检查

---

## [ ] 任务 6: 修复剩余前端组件（首页和其他）
- **Priority**: P0
- **Depends On**: Task 1
- **Description**: 
  - 更新 page.tsx（首页）
  - 更新 DraftStageView.tsx
  - 更新 CompletedProjectView.tsx
  - 更新 Skeleton.tsx 和 Spinner.tsx（如需要）
  - 更新 Toast.tsx
- **Success Criteria**:
  - 所有剩余页面组件无类型错误
- **Test Requirements**:
  - `programmatic` TR-6.1: 所有页面组件通过 TypeScript 检查

---

## [ ] 任务 7: 修复剩余 API 路由
- **Priority**: P0
- **Depends On**: Task 1
- **Description**: 
  - 批量更新剩余 API 路由字段名
  - 更新场景确认 API
  - 更新视频任务查询 API
  - 更新存储签名 URL API
- **Success Criteria**:
  - 所有 API 路由无类型错误
- **Test Requirements**:
  - `programmatic` TR-7.1: 所有 API 路由通过 TypeScript 检查

---

## [ ] 任务 8: 修复 Hooks 和 Providers
- **Priority**: P0
- **Depends On**: Task 1
- **Description**: 
  - 更新 useSignedUrls.ts
  - 更新 Providers.tsx（移除 Supabase Provider）
- **Success Criteria**:
  - Hooks 和 Providers 无类型错误
- **Test Requirements**:
  - `programmatic` TR-8.1: useSignedUrls.ts 和 Providers.tsx 通过 TypeScript 检查

---

## [ ] 任务 9: 最终验证和清理
- **Priority**: P0
- **Depends On**: Tasks 1-8
- **Description**: 
  - 运行完整 TypeScript 检查
  - 运行 ESLint 检查
  - 清理不再需要的文件
  - 更新 .env.local.example
- **Success Criteria**:
  - 零 TypeScript 错误
  - 零 ESLint 错误
- **Test Requirements**:
  - `programmatic` TR-9.1: `npx tsc --noEmit` 退出码 0
  - `programmatic` TR-9.2: `npm run lint` 无错误
  - `human-judgement` TR-9.3: 项目能正常构建

---

## 实施顺序

```
Task 1 (批量修复字段名)
    ↓
Tasks 2-8 (并行或顺序执行)
    ↓
Task 9 (最终验证)
```

**Note**: Task 1 是前置任务，需要先完成以减少其他任务的错误数量。
